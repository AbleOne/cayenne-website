<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title xmlns:d="http://docbook.org/ns/docbook">Guide to 3.1 Features</title><link rel="stylesheet" type="text/css" href="css/cayenne-doc.css"><meta xmlns:d="http://docbook.org/ns/docbook" name="keywords" content="Cayenne 3.1 documentation"><meta xmlns:d="http://docbook.org/ns/docbook" name="description" content="User documentation for Apache Cayenne version 3.1"><link rel="home" href="index.html" title="Cayenne New Features and Upgrade Guide"><link rel="up" href="index.html" title="Cayenne New Features and Upgrade Guide"><link rel="prev" href="index.html" title="Cayenne New Features and Upgrade Guide"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7036673-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
        </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:d="http://docbook.org/ns/docbook" class="navheader"><table width="100%" summary="Navigation header"><tr><th class="versioninfo">v.3.1 (3.1)</th><th align="center">Guide to 3.1 Features</th><th></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="article" title="Guide to 3.1 Features"><div class="titlepage"><div><div><h2 class="title"><a name="d0e18"></a>Guide to 3.1 Features</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ar01.html#ditribution-content-structure">Distribution Contents Structure</a></span></dt><dt><span class="section"><a href="ar01.html#cayenne-configuration">Cayenne Configuration</a></span></dt><dt><span class="section"><a href="ar01.html#framework-api">Framework API</a></span></dt><dt><span class="section"><a href="ar01.html#cayenne-modeler">CayenneModeler</a></span></dt><dt><span class="section"><a href="ar01.html#lifecycle-extensions">Lifecycle Extensions</a></span></dt></dl></div><p>This guide highlights the new features and changes introduced in 3.1 release. It is a
        high-level overview. For more details consult <span class="bold"><strong>RELEASE-NOTES.txt</strong></span> file included in each release for the full list of
        changes, and <span class="bold"><strong>UPGRADE.txt</strong></span> for the release-specific upgrade
        instructions.</p><div class="section" title="Distribution Contents Structure"><div class="titlepage"><div><div><h2 class="title"><a name="ditribution-content-structure"></a>Distribution Contents Structure</h2></div></div></div><p>Cayenne distribution is made leaner and more modular:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>"cayenne-modeler.jar" is no longer included in the "lib" folder, as it is no
                    longer used for loading local JNDI overrides. Of course "CayenneModeler-the-app"
                    is still included.</p></li><li class="listitem"><p>Ashwood library used for commit operation sorting is no longer a third-party
                    dependency. Instead a small subset of the relevant Ashwood classes got included
                    in Cayenne core.</p></li><li class="listitem"><p>The following helper modules are split away from Cayenne core:
                    "cayenne-project" and "cayenne-wocompat". They are bundled in CayenneModeler,
                    and are available from the source distribution. They are not included as
                    standalone jars in the binary distribution.</p></li></ul></div></div><div class="section" title="Cayenne Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="cayenne-configuration"></a>Cayenne Configuration</h2></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The new DI-based bootstrap and configuration
            approach is not API-compatible with earlier versions of Cayenne. Make sure
            you read the UPGRADE.txt file for instructions how to upgrade the existing
            projects.</p></div><div class="section" title="Dependency Injection Container"><div class="titlepage"><div><div><h3 class="title"><a name="d0e50"></a>Dependency Injection Container</h3></div></div></div><p>Cayenne 3.1 runtime stack is built around the ideas of Dependency Injection (DI),
                making it extremely flexible and easy to extend. It bundles a small, flexible
                annotations-based DI container to configure its services. The container provides DI
                services and exposes Cayenne extension points, but does not interfere with other DI
                containers that may be present in the application. I.e. it is invisible to the users
                who do not care about advanced Cayenne customization.</p></div><div class="section" title="Bootstrapping Cayenne in Various Environments"><div class="titlepage"><div><div><h3 class="title"><a name="d0e55"></a>Bootstrapping Cayenne in Various Environments</h3></div></div></div><p> Here is a simple example of starting a server-side Cayenne stack:</p><pre class="programlisting">ServerRuntime runtime = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</span> ServerRuntime(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-string">"cayenne-UntitledDomain.xml"</span>);</pre><p>For more detailed examples check the tutorials and other documentation.</p></div><div class="section" title="Configuring Local DataSources, Removal of JNDI Hack"><div class="titlepage"><div><div><h3 class="title"><a name="d0e64"></a>Configuring Local DataSources, Removal of JNDI Hack</h3></div></div></div><p>Cayenne 3.1 provides a property-based mechanism to override Modeler DataSource
                definitions, regardless of whether they are driver configurations, JNDI, DBCP, etc.
                A quick configuration example is shown below:</p><pre class="programlisting">-Dcayenne.jdbc.driver=com.mysql.jdbc.Driver -Dcayenne.jdbc.url=jdbc:mysql://localhost/mydb \
-Dcayenne.jdbc.username=user -Dcayenne.jdbc.password=password</pre><p>For more details and configuration options see javadocs of
                org.apache.cayenne.configuration.server.PropertyDataSourceFactory. </p><p>This feature supersedes what was formerly known as "JNDI hack", i.e. JNDI
                DataSource failover load strategy based on CayenneModeler preferences database. The
                problem with JNDI hack was unstable and frequently corrupted preferences database,
                and the need to include hsqldb and cayenne-modeler jars in the runtime. </p></div></div><div class="section" title="Framework API"><div class="titlepage"><div><div><h2 class="title"><a name="framework-api"></a>Framework API</h2></div></div></div><p>
            <span class="italic">See UPGRADE.txt for the full list of changes</span>
        </p><div class="section" title="Lifecycle Listener Annotations"><div class="titlepage"><div><div><h3 class="title"><a name="d0e83"></a>Lifecycle Listener Annotations</h3></div></div></div><p>Cayenne 3.1 features support for annotations on lifecycle listeners (but not yet
                on entity callback methods) that simplifies registering listeners via API. Our
                experience with Cayenne 3.0 shows that mapping listeners in the Modeler doesn't
                scale well to complex applications, and 3.0 API for mapping the listeners is hard to
                use. In 3.1 you can annotate listener methods and register multiple callback methods
                with a single call. </p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-comment">// declare a listener with annotated methods</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span> MyListener {
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@PostLoad(Entity1.class)</span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@PostPersist(Entity1.class)</span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</span> postLoad(Object object) {
        ....
    }
}

<span xmlns="http://www.w3.org/1999/xhtml" class="hl-comment">// register a listener</span>
ServerRuntime runtime = ..
MyListener listener = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</span> MyListener();
runtime.getChannel().getEntityResolver().getCallbackRegistry().addListener(listener);</pre><p>Moreover, unlike JPA annotations, Cayenne allows to attach a listener to a set of
                entities not known to the listener upfront, but that are all annotated with some
                custom annotation:</p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span> MyListener {
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@PostLoad(entityAnnotations = CustomAnnotation.class)</span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</span> postLoad(Object object) {
        ....
    }
}</pre></div><div class="section" title="DataChannelFilter for Intercepting DataDomain Operations"><div class="titlepage"><div><div><h3 class="title"><a name="d0e94"></a>DataChannelFilter for Intercepting DataDomain Operations</h3></div></div></div><p>Cayenne now features a DataChannelFilter interface that allows to intercept and
                alter all DataChannel traffic (i.e. selects and commits between a DataContext and
                DataDomain). It provides a chain of command API very similar to servlet filters.
                Filters are widely used by "cayenne-lifecyle" extensions and allow to build powerful
                custom object lifecycle-aware code. To install a filter, the following API is
                used:</p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span> MyFilter implement DataChannelFilter { .. }

MyFilter filter = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</span> MyFilter();
ServerRuntime runtime = ..
runtime.getDataDomain().addFilter(filter);</pre><p>Very often filters mark some of their own methods with lifecycle annotations so
                that certain operations can be triggered by Cayenne inside the scope of filter's
                onQuery() or onSync() methods. To ensure annotated methods are invoked, filter
                registration should be combined with listener registration:</p><pre class="programlisting">MyFilter filter = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</span> MyFilter();
ServerRuntime runtime = ..
runtime.getDataDomain().addFilter(filter);
runtime.getDataDomain().getEntityResolver().getCallbackRegistry().addListener(filter);
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-comment">// noticed that by default runtime.getDataDomain() is equivalent to runtime.getChannel()</span></pre></div></div><div class="section" title="CayenneModeler"><div class="titlepage"><div><div><h2 class="title"><a name="cayenne-modeler"></a>CayenneModeler</h2></div></div></div><div class="section" title="Java Preferences API"><div class="titlepage"><div><div><h3 class="title"><a name="d0e108"></a>Java Preferences API</h3></div></div></div><p>We got rid of HSQLDB-based preferences storage, and are using standard Java
                Preferences API for the Modeler preferences. This solved a long-standing stability
                issue with Modeler preferences. So no more lost user preferences.</p></div></div><div class="section" title="Lifecycle Extensions"><div class="titlepage"><div><div><h2 class="title"><a name="lifecycle-extensions"></a>Lifecycle Extensions</h2></div></div></div><p>Cayenne 3.1 includes an optional cayenne-lifecyle module that implements a few useful
            extensions based on DataChannelFilters and lifecycle annotations. Those include a
            concept of a String ID (which is a String URL-friendly representation of ObjectId),
            support for (de)referencing objects by String ID, String ID-based relationships,
            annotation-based cache groups invalidation, annotation-based audit of object changes,
            etc.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Cayenne New Features and Upgrade Guide&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>